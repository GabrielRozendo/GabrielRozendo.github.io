{{- $posts := "" -}}

{{- if .section -}}
    {{- $posts = (where site.RegularPages "Section" .section) -}}
{{- else -}}
    {{- if (eq .context.Kind "taxonomy") -}}
        {{- $posts = .context.Pages -}}
    {{- else -}}
        {{- if (eq .context.Kind "term") -}}
            {{- $posts = .context.Data.Pages -}}
	{{- else -}}
            {{- $posts = site.RegularPages }}
	{{- end -}}
    {{- end -}}
{{- end -}}

{{- $limit_exceeded:= "" -}}
{{- if (and .limit (gt (len $posts) .limit)) -}}
    {{- $limit_exceeded = true -}}
{{- else -}}
    {{- $limit_exceeded = false -}}
{{ end }}

{{- if (gt (len $posts) 0) }}
    {{- if .limit }}
        {{ $posts = (first .limit $posts ) }}
    {{ end }}
    <ul>
        {{- range $post := $posts -}}
        <li>
            <span>{{- ($post.Date | time.Format site.Params.theme_config.date_format) }}</span>
            <a href="{{ $post.Permalink | relURL }}">{{ $post.Title }}</a>
            {{/* Display categories and tags */}}
            {{- if or $post.Params.tags $post.Params.categories -}}
            <span style="margin-left: 0.5rem; font-size: 0.85rem;">
                {{ partial "post_tags.html" $post }}
            </span>
            {{- end -}}
        </li>
        {{ end }}
    </ul>
{{ end }}

